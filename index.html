<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dodentocht 2026 Mobile</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Doto 2026">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/854/854868.png">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a2a6c;
            --secondary: #b21f1f;
            --accent: #f39c12;
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --text: #1a202c;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body.dark-mode {
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text: #e8e8e8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            padding-bottom: calc(80px + var(--safe-bottom));
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 20px;
            border-bottom-left-radius: 25px;
            border-bottom-right-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .header h1 { font-size: 1.6rem; letter-spacing: -1px; }
        .countdown { font-size: 0.85rem; font-weight: bold; opacity: 0.9; }

        .container { padding: 15px; }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .card h2 { font-size: 1.1rem; margin-bottom: 15px; border-left: 4px solid var(--accent); padding-left: 10px; }

        /* Progress */
        .progress-container { height: 28px; background: #e2e8f0; border-radius: 14px; overflow: hidden; margin: 10px 0; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #48bb78, #38a169); width: 0%; transition: width 1s; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; font-weight: bold; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: var(--card-bg); padding: 15px; border-radius: 18px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-bottom: 3px solid var(--primary); }
        .stat-label { font-size: 0.65rem; text-transform: uppercase; color: #718096; font-weight: bold; }
        .stat-value { font-size: 1.3rem; font-weight: 800; display: block; }

        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--card-bg);
            display: flex;
            padding: 10px 0 calc(10px + var(--safe-bottom));
            box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-item { flex: 1; border: none; background: none; color: #718096; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 1.5rem; margin-bottom: 2px; }

        /* Lists */
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #edf2f7; }
        .list-info h4 { font-size: 0.95rem; }
        .list-info p { font-size: 0.75rem; color: #718096; }

        /* Form Elements */
        .form-field { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; font-weight: bold; margin-bottom: 4px; color: #4a5568; }
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #cbd5e0; background: var(--card-bg); color: var(--text); font-size: 1rem; }

        .btn-main { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 15px; font-weight: bold; font-size: 1rem; margin-top: 10px; }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .phase-header { background: var(--primary); color: white; padding: 10px 15px; border-radius: 10px; font-size: 0.8rem; margin: 20px 0 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
            <h1>DODENTOCHT 2026</h1>
            <div id="countdown" class="countdown">Laden...</div>
        </div>
        <button onclick="toggleTheme()" style="background: rgba(255,255,255,0.2); border: none; width: 40px; height: 40px; border-radius: 50%; color: white;">üåì</button>
    </div>
</div>

<div class="container">
    
    <div id="dash" class="tab-content active">
        <div class="card">
            <h2>üéØ Voortgang naar 800km</h2>
            <div class="progress-container">
                <div id="progressBar" class="progress-bar">0%</div>
            </div>
            <p id="progText" style="text-align: center; font-size: 0.75rem; color: #718096; margin-top: 5px;"></p>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <span class="stat-label">Totaal KM</span>
                <span id="totalKm" class="stat-value">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Snelheid</span>
                <span id="avgSpeed" class="stat-value">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Sessies</span>
                <span id="totalSess" class="stat-value">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Knie Score</span>
                <span id="kneeAvg" class="stat-value">0</span>
            </div>
        </div>

        <div class="card">
            <h2>üìà Evolutie</h2>
            <canvas id="speedChart" style="height: 200px;"></canvas>
        </div>
    </div>

    <div id="log" class="tab-content">
        <div class="card">
            <h2>üìù Nieuwe Log</h2>
            <div class="form-field">
                <label>Datum</label>
                <input type="date" id="tDate">
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-field" style="flex: 2;">
                    <label>KM</label>
                    <input type="number" id="tKm" step="0.1" placeholder="Afstand">
                </div>
                <div class="form-field" style="flex: 2;">
                    <label>Minuten</label>
                    <input type="number" id="tMin" placeholder="Duur">
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-field" style="flex: 1;">
                    <label>Knie (1-10)</label>
                    <input type="number" id="tKnee" value="0">
                </div>
                <div class="form-field" style="flex: 1;">
                    <label>Nacht?</label>
                    <select id="tNight">
                        <option value="false">Nee</option>
                        <option value="true">Ja üåô</option>
                    </select>
                </div>
            </div>
            <button class="btn-main" onclick="saveTraining()">LOG OPSLAAN</button>
        </div>

        <div class="card">
            <h2>üìã Geschiedenis</h2>
            <div id="historyList"></div>
        </div>
    </div>

    <div id="sch" class="tab-content">
        <div class="card">
            <h2>üìÖ Trainingsschema</h2>
            <div id="mobileSchedule"></div>
        </div>
    </div>

    <div id="lead" class="tab-content">
        <div class="card">
            <h2>üèÜ Leaderboard</h2>
            <div id="friendsList"></div>
            <hr style="margin: 15px 0; opacity: 0.1;">
            <div class="form-field">
                <label>Vriend toevoegen (Code)</label>
                <input type="text" id="friendCode" placeholder="Plak code hier">
            </div>
            <button class="btn-main" style="background: var(--accent);" onclick="addFriend()">VRIEND TOEVOEGEN</button>
        </div>
        
        <div class="card">
            <h2>‚öôÔ∏è Beheer</h2>
            <button class="btn-main" style="background: #718096; font-size: 0.8rem;" onclick="exportData()">DOWNLOAD BACKUP</button>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <button class="nav-item active" onclick="switchTab('dash', this)">
        <span class="nav-icon">üìä</span><span>Stats</span>
    </button>
    <button class="nav-item" onclick="switchTab('log', this)">
        <span class="nav-icon">üìù</span><span>Log</span>
    </button>
    <button class="nav-item" onclick="switchTab('sch', this)">
        <span class="nav-icon">üìÖ</span><span>Schema</span>
    </button>
    <button class="nav-item" onclick="switchTab('lead', this)">
        <span class="nav-icon">üèÜ</span><span>Groep</span>
    </button>
</nav>

<script>
    const STORAGE_KEY = 'dodentocht_v10_ultimate';
    const FRIENDS_KEY = 'dodentocht_v10_friends';
    const TARGET_KM = 800;
    const EVENT_DATE = new Date('2026-08-14');

    let trainings = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let friends = JSON.parse(localStorage.getItem(FRIENDS_KEY)) || [];
    let chart = null;

    // SCHEMA DATA UIT V10
    const SCHEDULE_DATA = [
        { phase: "FASE 1: BASIS (JAN-FEB)", weeks: [
            { w: 3, d: "12-18 jan", task: "16km Wandelen", note: "Basis" },
            { w: 4, d: "19-25 jan", task: "10km Herstel", note: "üí§ Rust" },
            { w: 5, d: "26 jan-1 feb", task: "18km Wandelen", note: "" },
            { w: 6, d: "2-8 feb", task: "20km Wandelen", note: "üéØ 20KM" }
        ]},
        { phase: "FASE 2: AFSTAND (MRT-APR)", weeks: [
            { w: 9, d: "23 feb-1 mrt", task: "25km Wandelen", note: "" },
            { w: 13, d: "23-29 mrt", task: "32km Wandelen", note: "üéØ 30KM+" },
            { w: 15, d: "6-12 apr", task: "35km Wandelen", note: "" }
        ]},
        { phase: "FASE 3: PIEK (MEI-JUN)", weeks: [
            { w: 18, d: "4-10 mei", task: "40km Wandelen", note: "üéØ 40KM" },
            { w: 22, d: "1-7 juni", task: "50km Wandelen", note: "üéØ 50KM" },
            { w: 26, d: "22-28 juni", task: "30km NACHT", note: "üåô Test" }
        ]},
        { phase: "FASE 4: FINALE (JUL-AUG)", weeks: [
            { w: 29, d: "13-19 juli", task: "60km TEST", note: "üî• ZWAAR" },
            { w: 33, d: "10-14 aug", task: "100KM", note: "üèÜ D-DAY" }
        ]}
    ];

    function init() {
        document.getElementById('tDate').valueAsDate = new Date();
        renderAll();
        updateCountdown();
        renderSchedule();
    }

    function switchTab(id, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'dash') renderChart();
    }

    function saveTraining() {
        const km = parseFloat(document.getElementById('tKm').value);
        const min = parseInt(document.getElementById('tMin').value);
        if(!km || !min) return alert('Vul alles in!');

        const t = {
            id: Date.now(),
            date: document.getElementById('tDate').value,
            km: km,
            min: min,
            knee: parseInt(document.getElementById('tKnee').value),
            night: document.getElementById('tNight').value === 'true',
            speed: (km / (min/60)).toFixed(2)
        };

        trainings.push(t);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(trainings));
        renderAll();
        switchTab('dash', document.querySelector('.nav-item'));
        
        // Reset
        document.getElementById('tKm').value = '';
        document.getElementById('tMin').value = '';
    }

    function renderAll() {
        const total = trainings.reduce((s, x) => s + x.km, 0);
        const kneeAvg = trainings.length ? (trainings.reduce((s, x) => s + x.knee, 0) / trainings.length).toFixed(1) : 0;
        
        document.getElementById('totalKm').innerText = total.toFixed(1);
        document.getElementById('totalSess').innerText = trainings.length;
        document.getElementById('kneeAvg').innerText = kneeAvg;
        
        const avgSpd = trainings.length ? (trainings.reduce((s, x) => s + parseFloat(x.speed), 0) / trainings.length).toFixed(2) : 0;
        document.getElementById('avgSpeed').innerText = avgSpd;

        const perc = Math.min((total / TARGET_KM) * 100, 100);
        document.getElementById('progressBar').style.width = perc + '%';
        document.getElementById('progressBar').innerText = Math.round(perc) + '%';
        document.getElementById('progText').innerText = `Nog ${(TARGET_KM - total).toFixed(1)} km te gaan`;

        renderHistory();
        renderChart();
    }

    function renderHistory() {
        const html = trainings.slice().reverse().map(t => `
            <div class="list-item">
                <div class="list-info">
                    <h4>${t.km} km ${t.night ? 'üåô' : ''}</h4>
                    <p>${t.date} ‚Ä¢ ${t.speed} km/u ‚Ä¢ Knie: ${t.knee}/10</p>
                </div>
                <button onclick="delT(${t.id})" style="background:none; border:none; font-size:1.2rem;">üóëÔ∏è</button>
            </div>
        `).join('');
        document.getElementById('historyList').innerHTML = html || '<p style="font-size:0.8rem; text-align:center; color:#999;">Nog geen trainingen.</p>';
    }

    function renderSchedule() {
        let html = '';
        SCHEDULE_DATA.forEach(p => {
            html += `<div class="phase-header">${p.phase}</div>`;
            p.weeks.forEach(w => {
                html += `
                <div class="list-item">
                    <div class="list-info">
                        <h4 style="font-size:0.85rem;">Week ${w.w}: ${w.task}</h4>
                        <p>${w.d}</p>
                    </div>
                    ${w.note ? `<span style="font-size:0.6rem; background:var(--accent); color:white; padding:2px 6px; border-radius:10px;">${w.note}</span>` : ''}
                </div>`;
            });
        });
        document.getElementById('mobileSchedule').innerHTML = html;
    }

    function renderChart() {
        const ctx = document.getElementById('speedChart').getContext('2d');
        if(chart) chart.destroy();
        const last10 = trainings.slice(-10);
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: last10.map(t => t.date.split('-').slice(1).join('/')),
                datasets: [{
                    label: 'Snelheid',
                    data: last10.map(t => t.speed),
                    borderColor: '#1a2a6c',
                    backgroundColor: 'rgba(26, 42, 108, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function delT(id) {
        if(confirm('Verwijderen?')) {
            trainings = trainings.filter(x => x.id !== id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(trainings));
            renderAll();
        }
    }

    function updateCountdown() {
        const diff = EVENT_DATE - new Date();
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        document.getElementById('countdown').innerText = `‚è∞ Nog ${days} dagen tot D-day`;
    }

    function toggleTheme() { document.body.classList.toggle('dark-mode'); }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(trainings));
        const dl = document.createElement('a');
        dl.setAttribute("href", dataStr);
        dl.setAttribute("download", "dodentocht_backup.json");
        dl.click();
    }

    window.onload = init;
</script>
</body>
</html>